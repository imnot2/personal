<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Port+Lligat+Sans|Rokkitt:400,700|Allerta|Alike|Pontano+Sans" />
</head>
<body>
    
</body>
<script src="http://lolita.englishtown.com/axis/_static/scripts/lib/jquery.js"></script>
<script>
$(function(){
    function Parse(str,selector){
        this.str = str;
        this.container = $(selector);
        this.init();
    }
    Parse.prototype = {
        init:function(){
            this.xmlDoc = $.parseXML('<wrap>'+this.str+'</wrap>');
            this.wrap = this.getBinding(this.xmlDoc);
            this.parse();
        },
        parse:function(){
            var me = this;
            var temp = me.xmlDoc.firstChild;
            while(temp){
                if(temp === me.xmlDoc) break;
                me.getBinding(temp);
                if(temp.childNodes.length){
                    temp = temp.firstChild;
                }else{
                    temp = me.getNext(temp);
                }
            }
            me.render();
        },
        getBinding:function(node){
            var htmlNode = this.build(node);

            var $node = $(node);
            var $htmlNode = $(htmlNode);    

            if($node.parent().length){
                $node.parent().data('toHtmlNode').append($htmlNode);
            } 

            $htmlNode.data('toSourceNode',$node);
            $node.data('toHtmlNode',$htmlNode);

            if($htmlNode.attr('type') === 'input'){
                $htmlNode.attr('contenteditable','true').on('input',function(e){
                    $(this).data('toSourceNode').html($(this).html());
                })
            }            
            return htmlNode;
        },
        getNext:function(node){            
            var next;
            if(node === this.xmlDoc) return node;
            next = node.nextSibling;
            if(!next) return arguments.callee.call(this,node.parentNode);
            return next;
        },
        build:function(node){
            var wrap;
            var nodeName = node.nodeName;
            var nodeType = {
                '#document':{
                    tag:'div'
                },
                'wrap':{
                    tag:'div'
                },
                'paragraph':{
                    tag:'span'
                },
                'input':{
                    tag:'p'
                },
                'abc':{
                    tag:'span'
                },
                'text':{
                    tag:'span'
                }
            }
            if(!nodeType[nodeName] && nodeName === '#text'){
                wrap = document.createTextNode(node.nodeValue);
            }else{
                wrap = document.createElement(nodeType[nodeName] ? nodeType[nodeName].tag : nodeName);
                wrap.setAttribute('type',nodeName);
            }
            return wrap;
        },
        getCont:function(){
            return this.xmlDoc.documentElement.innerHTML;
        },
        render:function(){
            this.container[0].appendChild(this.wrap);
        }
    }
    var str = '<paragraph><input>aaaa<b>Bold text</b></input><text>fixed text</text><text><abc>Free text generated by the user</abc></text><text>A combination <abc>of <code a="DD" c="">the</code> <code a="SP" c="text">texte</code> generated by the user</abc> and <c>fixed</c> text which does not require correction.</text><text>It also supports the following markup options:<br/><i>Italic text</i><br/><b>Bold text</b><br/><c>highlighted text</c><br/><i><b>any</b></i> combinations of them.</text></paragraph>';
    var p = new Parse(str,'body');
    window.sourceXml = p.xmlDoc;
})
    
</script>
</html>